---
title: "Extracting Demographic and Diagnostic Sample Data from GDC"
author: "Michael Kesling"
date: "7/25/2019"
output: rmarkdown::github_document # html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## Extracting Demographic and Diagnostic Data from NCI's Genomic Data Commons (GDC)

In order to correctly select the pertinent RNA-Seq samples from TCGA project, it's necessary to 
access data about the samples from the NCI's Genomic Data Commons (GDC), where the data are now
warehoused (https://gdc.cancer.gov).

An Bioconductor package named 'GenomicDataCommons' is utilized here in order to explore and
then extract the relevant fields of sample attributes.  The 'BiocManager' package must first be
installed in order to install bioconductor packages.


```{r}
# BiocManager::install('GenomicDataCommons')     # already installed on my machine
suppressMessages(require(GenomicDataCommons))
suppressMessages(require(dplyr))
suppressMessages(require(knitr))
```

## Understanding TCGA Identifiers

Each RNA-Seq file that was generated by TCGA, whether it was obtained directly through GDC or
from the Wang publication of cross-study normalized data, is identified through its TCGA identifier.

![TCGA Codes](TCGA_Codes.png)




```{r, echo=FALSE}
tcgaDF <- read.csv("TCGA_Table.tsv", sep="\t")
knitr::kable(tcgaDF, table.attr="sytle='width:70%;'")  # adjust width some other way
```

While other fields in the TCGA identifier may be important, the "TSS", "Participant", and "Sample" fields are sufficient for identifying the desired samples.

#### Exploring GDC Sample Attributes

We are going to follow the ![Vignette for the GenomicDataCommons package](https://bioconductor.org/packages/release/bioc/vignettes/GenomicDataCommons/inst/doc/overview.html).

As the sample attributes of $Demographics$ and $Diagnostics$ all fall under the umbrella of the $cases$, we'll access our data through the $GenomicDataCommons$ function $cases()$.

Let's start out by simply asking how many different $cases$ are stored by GDC:
```{r}
cases() %>% count()
```
We see that there are over 34,000 cases as of July 2019.

#### Identifying Breast Cancer Project ID
As we're focusing on breast cancer, and the samples are grouped into projects according to the type of cancer, we'll need to determine the correct identifier for subsetting all cases by those involving breast cancer.

First, we need to determine the exact field and identifier for the $Project ID$.  We'll use the $grep()$ function to try and find that field.
```{r}
project_fields <- grep('pro', available_fields('cases'), value=TRUE)
print(project_fields)
```
It appears that the exact field name is "project.project_id".
Let's determine what value a project ID would have for a breast cancer sample.
```{r}
cases() %>%
   facet('project.project_id') %>%  
   aggregations() %>%
   head(5)
```
We can see that one of the most popular entries under 'project_id' is 'TCGA-BRCA', giving 1098 cases as of July 2019.  We will focus on this dataset going forward.

#### Identifying TCGA identifier
We need to ensure that for the breast cancer sample attributes we download, that there is a TCGA ID related to the case number.  We'll need that for identifying the right RNA-Seq identifiers later on.

We start by figuring out what the 'case id' might be called in GDC. We $grep()$ for 'case':
```{r}
case_fields <- grep('case', available_fields('cases'), value=TRUE)
print(case_fields)
```
XXXXXXXXX
XXXXXXXXX
There are quite a few options from which to choose the right identifier.  More than one identifier will serve our purpose, as long as it begins with $TCGA$, and contains the $TSS$, $Participant$, and $Sample$ fields.
It appears that 'submitter_sample_ids' will suffice for our purpose

#### Exploring Sub-Classes of Breast cancer
We select out only those cases that are breast cancer and see what data are available to us:

```{r}
cases() %>%
   GenomicDataCommons::filter( ~ project.project_id == 'TCGA-BRCA') %>%   # '~' needed
   aggregations() %>%
   head(5)
```










