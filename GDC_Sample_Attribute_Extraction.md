Extracting Demographic and Diagnostic Sample Data from NCI's Genomic Data Commons (GDC)
================
Michael Kesling
7/25/2019



### Document in Progress

In order to correctly select the pertinent RNA-Seq samples from The Cancer Genome Atlas (TCGA) project, it's necessary to access attribute data about the samples from the NCI's Genomic Data Commons (GDC), where the data are now warehoused (<https://gdc.cancer.gov>).

A Bioconductor package named 'GenomicDataCommons' is utilized here in order to explore and then extract the relevant fields of sample attributes. The 'BiocManager' package must first be installed in order to install bioconductor packages.

#### Note:

Some of the code is not shown on the GitHub website. One needs to look at the [R Markdown file](https://github.com/keslingmj/RNASeq/blob/master/GDC_Sample_Attribute_Extraction.Rmd).

Understanding TCGA Identifiers
------------------------------

Each RNA-Seq file that was generated by TCGA, whether it was obtained directly through GDC or from the Wang publication of cross-study normalized data, is identified through its TCGA identifier. This identifier gives important information regarding the type of sample used, and is essential for mapping attribute data on GDC to other published studies.

![TCGA Codes](TCGA_Codes.png)

| Label       | Identifier\_for             |  Value| Value\_Description                                     | Possible\_Values                                                                                                                                                            |
|:------------|:----------------------------|------:|:-------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| TSS         | Tissue Source Site          |      2| GBM (brain tumor) sample from MD Anderson              | see <https://gdc.cancer.gov/resources-tcga-users/tcga-code-tables/tissue-source-site-codes> for complete list                                                               |
| Participant | Study Participant (Patient) |     14| The 14th participant from the GBM Study of MD Anderson | Any alph-numeric value                                                                                                                                                      |
| Sample      | Sample Type                 |      1| A solid tumor                                          | Tumor types range from 01-09, normal types from 10-19, and control samples from 20-29. See <https://gdc.cancer.gov/resources-tcga-users/tcga-code-tables/sample-type-codes> |

While other fields in the TCGA identifier may be important, the "TSS", "Participant", and "Sample" fields are sufficient for identifying the desired sample attributes on GDC.

#### Exploring GDC Sample Attributes

We using the [Vignette for the GenomicDataCommons package](https://bioconductor.org/packages/release/bioc/vignettes/GenomicDataCommons/inst/doc/overview.html) to explore and query the GDC data.

As the sample attributes of *Demographics* (characteristics of the human patient such as age, sex, race, etc.) and *Diagnoses* (characteristics of the tumor/healthy sample such as stage of cancer, new diagnosis/recurrence, etc.) all fall under the umbrella of the *cases*, we'll access our data through the *GenomicDataCommons* function *cases()*.

Let's start out by simply asking how many different *cases* are stored by GDC:

``` r
cases() %>% count()
```

    ## [1] 34893

We see that there are over 34,000 cases as of July 2019.

#### Identifying Breast Cancer Project ID

As we're focusing on breast cancer, and the samples are grouped into projects according to the type of cancer, we'll need to determine the correct identifier for subsetting all cases by those involving breast cancer.

First, we need to determine the exact field and identifier for the *Project ID*. We'll use the *grep()* function to try and find that field.

``` r
project_fields <- grep('proj', available_fields('cases'), value=TRUE)
print(project_fields)
```

    ##  [1] "project.dbgap_accession_number"        
    ##  [2] "project.disease_type"                  
    ##  [3] "project.intended_release_date"         
    ##  [4] "project.name"                          
    ##  [5] "project.primary_site"                  
    ##  [6] "project.program.dbgap_accession_number"
    ##  [7] "project.program.name"                  
    ##  [8] "project.program.program_id"            
    ##  [9] "project.project_id"                    
    ## [10] "project.releasable"                    
    ## [11] "project.released"                      
    ## [12] "project.state"                         
    ## [13] "tissue_source_site.project"

It appears that the exact field name is *project.project\_id*. Let's determine what value a project ID would have for a breast cancer sample.

``` r
projClasses <- cases() %>%
   facet('project.project_id') %>%  
   aggregations()
head(projClasses$project.project_id)
```

    ##             key doc_count
    ## 1         FM-AD     18004
    ## 2    TARGET-NBL      1120
    ## 3     TCGA-BRCA      1098
    ## 4 MMRF-COMMPASS       995
    ## 5    TARGET-AML       988
    ## 6     TARGET-WT       652

We can see that one of the most popular entries under 'project\_id' is 'TCGA-BRCA', giving 1098 cases of breast cancer as of July 2019. We will focus on this dataset going forward.

#### Identifying TCGA identifier and Downloading Sample Data

We need to ensure that for the breast cancer sample attributes we download, that there is a TCGA ID related to the case number. We'll need that for identifying the right RNA-Seq identifiers in other publications later on.

The 'case\_id' is needed for joining data across tables or object, but its format is not in the TCGA format. e.g. `87b85935-a058-44ad-8fb6-8511130eaffe`

We start by figuring out what the 'sample\_id' might be called in GDC. We'll use *grep()* for this:

``` r
sample_fields <- grep('sample_id', available_fields('cases'), value=TRUE)
print(sample_fields)
```

    ## [1] "sample_ids"           "samples.sample_id"    "submitter_sample_ids"

More than one identifier will serve our purpose, as long as it begins with *TCGA*, and contains the *TSS*, *Participant*, and *Sample* fields. Based on iterating through this code previously, it was found that *submitter\_sample\_ids* will suffice for our purpose, as shown with the following code. We are going to pull all the sample attribute data that we'll need, and we'll look at it step-by-step below, starting with the *submitter\_sample\_ids*.

``` r
expands = c("diagnoses","annotations",
            "demographic","exposures")
brcaResults <- cases() %>%
   GenomicDataCommons::filter(~ project.project_id == 'TCGA-BRCA') %>%
   GenomicDataCommons::select("submitter_sample_ids") %>%
   GenomicDataCommons::expand(expands)   %>%
   response_all()
print(head(brcaResults$results$submitter_sample_ids, n=2))
```

    ## $`87b85935-a058-44ad-8fb6-8511130eaffe`
    ## [1] "TCGA-D8-A1XV-10A" "TCGA-D8-A1XV-01A" "TCGA-D8-A1XV-01Z"
    ## 
    ## $`dd96a9c7-899c-47cd-a0f9-b149ed07a5d6`
    ## [1] "TCGA-D8-A1JB-10A" "TCGA-D8-A1JB-01Z" "TCGA-D8-A1JB-01A"

We see that the *TSS*, *Participant*, and *Sample* fields are present in these *submitter\_sample\_ids*.

In addition to the 2 printed examples of *case\_id* -&gt; *submitter\_sample\_id* mapping, another one of interest is:

$`f06f09f3-8133-4a92-ac86-fbe64295e0d8` \[1\] "TCGA-E9-A1ND-10A" "TCGA-E9-A1ND-01Z" "TCGA-E9-A1ND-01A" "TCGA-E9-A1ND-11A"

The *case\_id* begins with 'f06f...' We see that it maps to 4 distinct *submitter\_sample\_id*s. Each one begins with 'TCGA-E9-A1ND'. "E9" is the code for the "Breast Invasive Carcinoma" study at the Asterand Biosciences. "A1ND" is the patient/participant code for that study. We notice that these values are the same for all 4 *submitter\_sample\_id* codes, which says that all 4 samples were generated from the same patient. 2 of the sample\_code fields are "01Z" and "01A". 01 refers to a "Primary Solid Tumor", and A and Z refer to the fact that these are 2 separate samples. I assume that are labeled A and Z (rather than A and B) because they are the 1st and 2nd Primary Solid Tumors out of a total of 2 (rather than the 1st and 2nd out of several). We also notice that this patient has 2 other samples whose sample type is 10 = "Blood-Derived Normal Cell" and 11 = "Solid Tissue Normal". That means that 2 non-cancerous controls were taken from this patient, in addition to the 2 primary solid tumor samples taken.

#### Exploring *brcaResults* Data Object

brcaResults is the name of the GDCcasesResponse object, which is fundamentally a list, that was returned from the data query to GDC. We'd like to understand how the *demographic*, *diagnoses*, *exposure*, and *annotations* objects are organized.

``` r
dem <- class(brcaResults$results$demographic)
diag <- class(brcaResults$results$diagnoses)      # list of data.frames
annot <- class(brcaResults$results$annotations)    # list. sparsely populated
exp <- class(brcaResults$results$exposures) 
print(c("demographic ->", dem, "diagnostic ->", diag, "exposures -> ", exp, "annotations -> ", annot))
```

    ## [1] "demographic ->"  "data.frame"      "diagnostic ->"   "list"           
    ## [5] "exposures -> "   "list"            "annotations -> " "list"

We can see that *demographic* is a data frame. (It contains the demographic data directly.) Right now, we'll explore how the *annotations* and *diagnoses* lists are laid out, and how sparse they are.

``` r
lists <- c("brcaResults$results$annotations", "brcaResults$results$diagnoses")
for(listName in lists){
   numAnnotNull <- 0
   resNum <- 0
   for(result in eval(parse(text=listName))){
      resNum = resNum+ 1
      if(is.null(result)){
         numAnnotNull = numAnnotNull + 1
      }
   }
   print(paste("The fraction of the ", listName, " list records that are empty is ", numAnnotNull/resNum))
}
```

    ## [1] "The fraction of the  brcaResults$results$annotations  list records that are empty is  0.973588342440802"
    ## [1] "The fraction of the  brcaResults$results$diagnoses  list records that are empty is  0.000910746812386157"

Clearly, the *annotations* list is almost completely empty, so we'll want to ignore it for this work, while the *diagnoses* list is almost entirely populated and we'll want to use it.

The structure of the *exposures* list of dataframes is a bit different, as empty fields are still populated with a header. Let's see how well it's populated:

``` r
# relevant fields: # "alcohol_history"="Not Reported",
fields <- c("cigarettes_per_day", "alcohol_intensity", "bmi", "years_smoked")

numAnnotNull <- 0
resNum <- 0
for(result in brcaResults$results$exposures){
   if(!is.null(result)){
      resNum = resNum + 1
      if(all(is.na(result[fields])) & result$alcohol_history=="Not Reported"){
         numAnnotNull = numAnnotNull + 1
      }
   }
}
print(paste("The fraction of the exposures records that are empty is ", numAnnotNull/resNum))
```

    ## [1] "The fraction of the exposures records that are empty is  1"

So clearly the *exposures* list has no useful information.

#### Exploring Sub-Classes of Breast cancer

We select out only those cases that are breast cancer and see what data are available to us:

``` r
cases() %>%
   GenomicDataCommons::filter( ~ project.project_id == 'TCGA-BRCA') %>%   # '~' needed
   facet('disease_type') %>%
   aggregations() %>%
   head()
```

    ## $disease_type
    ##                                     key doc_count
    ## 1          Ductal and Lobular Neoplasms      1054
    ## 2 Cystic, Mucinous and Serous Neoplasms        16
    ## 3          Complex Epithelial Neoplasms        14
    ## 4             Epithelial Neoplasms, NOS         5
    ## 5          Adenomas and Adenocarcinomas         3
    ## 6             Fibroepithelial Neoplasms         2
    ## 7               Squamous Cell Neoplasms         2
    ## 8  Adnexal and Skin Appendage Neoplasms         1
    ## 9                  Basal Cell Neoplasms         1

We see that 'Ductal and Lobular Neoplasms' cover almost all cases. Ignoring other cases will help reduce confusion in our later analysis.

#### Pulling Breast Cancer sample attribute data

``` r
expands = c("diagnoses","annotations",
            "demographic","exposures")
brcaResults <- cases() %>%
   GenomicDataCommons::filter(~ project.project_id == 'TCGA-BRCA') %>%
   GenomicDataCommons::select("submitter_sample_ids") %>%
   GenomicDataCommons::expand(expands)   %>%
   response_all()
```

#### Exploring Local *b**r**c**a**R**e**s**u**l**t**s* Data Object

The *b**r**c**a**R**e**s**u**l**t**s* object that we've just downloaded contains data from the 'diagnoses', 'annotations', 'demographic', and 'exposures'. We need to look at what each one of these 4 contains in order to figure out if: (1) Do a large proportion of the cases have populated the data fields in the relevant object? If not, then while that data might be of strong interest, using it would likely cause a strong bias in the samples we select. (2) Among well-populated objects, which fields do we want to focus on?

#### Structure and Fields in *d**e**m**o**g**r**a**p**h**i**c* Object

We begin by looking at the structure and the various data fields in the *d**e**m**o**g**r**a**p**h**i**c* object.

``` r
class(brcaResults$results$demographic)
```

    ## [1] "data.frame"

``` r
colnames(brcaResults$results$demographic)
```

    ##  [1] "updated_datetime" "created_datetime" "gender"          
    ##  [4] "state"            "submitter_id"     "year_of_birth"   
    ##  [7] "race"             "days_to_birth"    "ethnicity"       
    ## [10] "vital_status"     "demographic_id"   "age_at_index"    
    ## [13] "year_of_death"    "days_to_death"

We see that the *demographic* object is a data frame, and that it contains 14 data fields. Of those, we're going to be interested in *race*, *days\_to\_birth*, *ethnicity*, *vital\_status*, *age\_at\_index*, *days\_to\_death*, *year\_of\_birth*, and *year\_of\_death*.
